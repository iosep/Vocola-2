##
## 
##

INPUT=input
FAIL_INPUT=input.fail
#ARGUMENTS=-f -extensions extensions.csv -log_stdout -debug 2
ARGUMENTS=-f -extensions extensions.csv -log_stdout

compare:
	rm -rf /tmp/new.log /tmp/new.fail.log 
	rm -rf /tmp/new /tmp/new.fail
	mkdir  /tmp/new /tmp/new.fail
	-COMPUTERNAME=mdl  python ../src/exec/vcl2py.py ${ARGUMENTS} ${INPUT} /tmp/new > /tmp/new.log
	find /tmp/new -type f -exec ruby -E Windows-1252 -i -pe 'gsub(/Generated by vcl2py 2\..*/, "VERSION")' {} \;
	-COMPUTERNAME=mdl  python ../src/exec/vcl2py.py ${ARGUMENTS} ${FAIL_INPUT} /tmp/new.fail > /tmp/new-fail.log
	find /tmp/new.fail -type f -exec ruby -E Windows-1252 -i -pe 'gsub(/Generated by vcl2py 2\..*/, "VERSION")' {} \;
	#
	-diff -r /tmp/old          /tmp/new
	-diff    /tmp/old.log      /tmp/new.log
	-diff    /tmp/old-fail.log /tmp/new-fail.log


load-comparison:
	rm -rf /tmp/old.log /tmp/old.fail.log 
	rm -rf /tmp/old /tmp/old.fail
	mkdir  /tmp/old /tmp/old.fail
	-COMPUTERNAME=mdl  python ../src/exec/vcl2py.py ${ARGUMENTS} ${INPUT} /tmp/old > /tmp/old.log
	find /tmp/old -type f -exec ruby -E Windows-1252 -i -pe 'gsub(/Generated by vcl2py 2\..*/, "VERSION")' {} \;
	-COMPUTERNAME=mdl  python ../src/exec/vcl2py.py ${ARGUMENTS} ${FAIL_INPUT} /tmp/old.fail > /tmp/old-fail.log
	find /tmp/old.fail -type f -exec ruby -E Windows-1252 -i -pe 'gsub(/Generated by vcl2py 2\..*/, "VERSION")' {} \;

clean::
	rm -rf /tmp/old     /tmp/old.fail
	rm -rf /tmp/new     /tmp/new.fail
	rm -rf /tmp/old.log /tmp/old.fail.log 
	rm -rf /tmp/new.log /tmp/new.fail.log 


build-input:
	rm -rf input input.fail
	mkdir  input input.fail
	#
	(cd ~/voice/my_commands; make clean; make source; make)
	cp ~/voice/my_commands/to_Vocola/* input/
	#
	cp ../regression/*.vcl ../regression/*.vch  ../regression/mangling\ tests/*   input/
	cp -r ../regression/subdirectory   input/
	rm input/*fail*
	rm input/subdirectory/*fail*
	cp -r ../regression/*fail* input.fail/
	cp -r ../regression/subdirectory input.fail/
	#
	cp new_inputs/* input/

clean::
	rm -rf input input.fail
